# agents/malware_agent.py
import json
from crewai import Agent, Task
from .common import get_llm

malware_agent = Agent(
    role="Malware Response Agent",
    goal="Propose precise, actionable steps to contain and eradicate malware.",
    backstory="Specialist in malware, ransomware, trojans, droppers, C2 beacons.",
    verbose=False,
    llm=get_llm()
)

def make_malware_task(validated_json: str, record: dict) -> Task:
    rec = json.dumps(record, default=str)
    prompt = f"""
You are the Malware Response Agent.

Validated Event (JSON):
{validated_json}

Original Record (JSON):
{rec}

Output a concise MARKDOWN action plan:
- Immediate actions (bullets)
- Containment rules (bullets)
- Eradication/Recovery (bullets)
- Monitoring (1â€“2 bullets)
    """.strip()
    return Task(
        description=prompt,
        expected_output="Markdown action plan for malware",
        agent=malware_agent
    )

# Default task for pipeline
malware_task = make_malware_task("{}", {})
